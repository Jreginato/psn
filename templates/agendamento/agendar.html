{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Agende sua avaliação com personal trainer online" />
    <title>Agendar Avaliação | Personal Trainer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/sales.css' %}" />
    <style>
        .form-section {
            padding: 80px 0;
        }
        .form-wrapper {
            max-width: 600px;
            margin: 0 auto;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 40px;
        }
        .form-wrapper h1 {
            margin-bottom: 10px;
        }
        .form-wrapper p {
            color: var(--muted);
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .form-input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-family: 'Inter', sans-serif;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        select.form-input {
            background: #1a2942;
            color: var(--text);
            cursor: pointer;
        }
        select.form-input option {
            background: #1a2942;
            color: var(--text);
            padding: 10px;
        }
        .errorlist {
            list-style: none;
            padding: 0;
            margin: 8px 0 0;
            color: #ff6b6b;
            font-size: 0.9rem;
        }
        .help-text {
            font-size: 0.85rem;
            color: var(--muted);
            margin-top: 6px;
        }
    </style>
</head>
<body>
    <header class="topbar" id="topbar">
        <div class="container nav-wrap">
            <a href="{% url 'sales' %}" class="brand">Personal<span>Trainer</span></a>
            <nav class="nav">
                <a href="{% url 'produtos:catalogo' %}">Catálogo</a>
                <a href="{% url 'sales' %}#beneficios">Benefícios</a>
                <a href="{% url 'sales' %}#servicos">Treinamento</a>
                <a href="{% url 'sales' %}#faq">FAQ</a>
            </nav>
            <div class="nav-actions">
                <a href="{% url 'carrinho:carrinho_detalhes' %}" class="btn btn-ghost btn-sm" style="position: relative;">
                    <i class="fas fa-shopping-cart"></i>
                    {% if carrinho|length > 0 %}
                        <span style="position: absolute; top: -5px; right: -5px; background: var(--primary); color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 11px; display: flex; align-items: center; justify-content: center; font-weight: bold;">{{ carrinho|length }}</span>
                    {% endif %}
                </a>
                {% if user.is_authenticated %}
                <a href="{% url 'dashboard:home' %}" class="btn btn-ghost btn-sm">
                    <i class="fas fa-user-circle"></i> Área do Aluno
                </a>
                {% else %}
                <a href="{% url 'accounts:login' %}" class="btn btn-ghost btn-sm">
                    <i class="fas fa-sign-in-alt"></i> Entrar
                </a>
                {% endif %}
                <a href="{% url 'agendamento:agendar' %}" class="btn btn-primary btn-sm">Agendar avaliação</a>
            </div>
        </div>
    </header>

    <main>
        <section class="form-section">
            <div class="container">
                <div class="form-wrapper">
                    <h1>Agendar Avaliação</h1>
                    <p>Preencha o formulário e retornaremos em breve para confirmar sua avaliação.</p>
                    
                    <form method="post" id="agendamento-form">
                        {% csrf_token %}
                        
                        {% for field in form %}
                        <div class="form-group">
                            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                            {{ field }}
                            {% if field.name == 'data_desejada' %}
                                <div class="help-text">⚠️ Não atendemos aos domingos</div>
                            {% endif %}
                            {% if field.name == 'horario_desejado' %}
                                <div class="help-text">⏰ Horários disponíveis: 08:00 às 18:00</div>
                            {% endif %}
                            {% if field.errors %}
                                <ul class="errorlist">
                                    {% for error in field.errors %}
                                    <li>{{ error }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                        {% endfor %}
                        
                        <button type="submit" class="btn btn-primary w-full">Enviar Agendamento</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container footer-wrap">
            <p>© 2026 Personal Trainer. Todos os direitos reservados.</p>
            <a href="{% url 'sales' %}">Voltar ao início</a>
        </div>
    </footer>

    <script src="{% static 'js/sales.js' %}"></script>
    <script>
        // Bloquear domingos no calendário
        const dataInput = document.querySelector('input[type="date"]');
        if (dataInput) {
            // Definir data mínima como hoje
            const hoje = new Date();
            const dataMinima = hoje.toISOString().split('T')[0];
            dataInput.setAttribute('min', dataMinima);
            
            dataInput.addEventListener('input', function() {
                const valorData = this.value;
                const selectedDate = new Date(valorData + 'T00:00:00');
                const dataHoje = new Date(dataMinima + 'T00:00:00');
                
                // Verificar se é data passada
                if (selectedDate < dataHoje) {
                    alert('Não é possível agendar para datas passadas.');
                    this.value = '';
                    return;
                }
                
                // Verificar se é domingo
                if (selectedDate.getDay() === 0) {
                    alert('Não atendemos aos domingos. Por favor, escolha outro dia.');
                    this.value = '';
                }
            });
        }

        // Máscara de telefone brasileira: (XX) XXXX-XXXX ou (XX) XXXXX-XXXX
        const telefoneInput = document.querySelector('input[name="telefone"]');
        if (telefoneInput) {
            telefoneInput.addEventListener('input', function(e) {
                let valor = e.target.value;
                
                // Remove tudo que não é dígito
                valor = valor.replace(/\D/g, '');
                
                // Limita a 11 dígitos
                valor = valor.substring(0, 11);
                
                // Aplica a máscara
                if (valor.length <= 10) {
                    // Formato: (XX) XXXX-XXXX
                    valor = valor.replace(/^(\d{2})(\d{0,4})(\d{0,4}).*/, function(match, p1, p2, p3) {
                        let result = '';
                        if (p1) result = '(' + p1;
                        if (p2) result += ') ' + p2;
                        if (p3) result += '-' + p3;
                        return result;
                    });
                } else {
                    // Formato: (XX) XXXXX-XXXX
                    valor = valor.replace(/^(\d{2})(\d{5})(\d{0,4}).*/, function(match, p1, p2, p3) {
                        let result = '(' + p1 + ') ' + p2;
                        if (p3) result += '-' + p3;
                        return result;
                    });
                }
                
                e.target.value = valor;
            });
            
            // Placeholder ajuda visual
            telefoneInput.placeholder = '(00) 00000-0000';
        }
    </script>

    <!-- WhatsApp Flutuante -->
    <a href="https://wa.me/5511999999999" target="_blank" rel="noopener" class="whatsapp-float" aria-label="WhatsApp">
        <svg width="32" height="32" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </a>
</body>
</html>
